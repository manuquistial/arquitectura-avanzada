# Production Environment Values
# Override default values.yaml for production deployments

global:
  environment: production
  imageRegistry: "" # Will be set by CI/CD
  imagePullPolicy: IfNotPresent
  
  # Hub Configuration
  hubBaseUrl: "https://govcarpeta-apis-4905ff3c005b.herokuapp.com"
  allowInsecureOperatorUrls: false  # Only https:// in production
  sasTtlMinutes: 15
  rateLimitToHub: 10
  
  # Circuit Breaker
  circuitBreaker:
    window: "60s"
    threshold: 5
    cooldown: "120s"
  
  # CORS
  corsAllowedOrigins: "https://carpeta-ciudadana.example.com"  # Specific domain in production
  
  # Observability
  otel:
    enabled: true
    endpoint: "http://otel-collector-opentelemetry-collector.observability.svc.cluster.local:4317"
    insecure: true
  
  logLevel: "INFO"

# Replicas for production (higher availability)
replicaCount: 3

# Frontend
frontend:
  enabled: true
  replicaCount: 3
  image:
    repository: carpeta-ciudadana-frontend
    tag: latest
  env:
    NEXT_PUBLIC_API_URL: "https://production-carpeta-endpoint-czh6asc2fagng0b7.z01.azurefd.net"
  nextAuth:
    secret: "" # Set via CI/CD from Terraform outputs
    url: "https://app.carpeta-ciudadana.com" # Configurable domain
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  service:
    type: ClusterIP
    port: 3000
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70

# Gateway - DISABLED (Using Azure API Management instead)
gateway:
  enabled: false  # Disabled - Using Azure API Management for API routing
  replicaCount: 0
  image:
    repository: carpeta-ciudadana-gateway
    tag: latest
  resources:
    requests:
      cpu: 0m
      memory: 0Mi
    limits:
      cpu: 0m
      memory: 0Mi
  autoscaling:
    enabled: false
    minReplicas: 0
    maxReplicas: 0
    targetCPUUtilizationPercentage: 70

# Transfer Worker
transferWorker:
  enabled: true
  replicaCount: 2
  image:
    repository: carpeta-ciudadana-transfer-worker
    tag: latest
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
  podDisruptionBudget:
    enabled: true
    useMaxUnavailable: true
    maxUnavailable: 1

# Citizen Service
citizen:
  enabled: true
  replicaCount: 3
  image:
    repository: carpeta-ciudadana-citizen
    tag: latest
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10

# Ingestion Service
ingestion:
  enabled: true
  replicaCount: 3
  image:
    repository: carpeta-ciudadana-ingestion
    tag: latest
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10

# Metadata Service
metadata:
  enabled: true
  replicaCount: 3
  image:
    repository: carpeta-ciudadana-metadata
    tag: latest
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10

# Transfer Service
transfer:
  enabled: true
  replicaCount: 3
  image:
    repository: carpeta-ciudadana-transfer
    tag: latest
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 15

# MinTIC Client
minticClient:
  enabled: true
  replicaCount: 3
  image:
    repository: carpeta-ciudadana-mintic-client
    tag: latest
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10

# Signature Service
signature:
  enabled: true
  replicaCount: 3
  image:
    repository: carpeta-ciudadana-signature
    tag: latest
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10

# Read Models Service
readModels:
  enabled: true
  replicaCount: 3
  image:
    repository: carpeta-ciudadana-read-models
    tag: latest
  service:
    type: ClusterIP
    port: 8007
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 256Mi
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70

# Notification Service
notification:
  enabled: true
  replicaCount: 2
  image:
    repository: carpeta-ciudadana-notification
    tag: latest
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi


# Ingress
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod  # Use production Let's Encrypt
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
  tls:
    enabled: true
    secretName: carpeta-ciudadana-tls

# Database Configuration (Production)
database:
  connectionString: "" # Set via CI/CD from Terraform outputs
  host: "production-psql-k85bv.postgres.database.azure.com"
  port: 5432
  username: "psqladmin"
  password: "" # Set via CI/CD from Terraform outputs
  database: "carpeta_ciudadana"

# PostgreSQL (external)
postgresql:
  enabled: false  # We use Azure PostgreSQL Flexible Server
  external:
    enabled: true
    # Host will be set by CI/CD from Terraform outputs

# Redis Configuration (Production)
redis:
  host: "production-redis.redis.cache.windows.net"
  port: 6380  # SSL port
  password: "" # Set via CI/CD from Terraform outputs
  ssl: true

# Redis (external)
redis:
  enabled: false  # We use Azure Cache for Redis
  external:
    enabled: true
    host: "redis.default.svc.cluster.local"
    port: 6379
    # Password will be set by CI/CD

# OpenSearch (external)
opensearch:
  enabled: false  # Installed separately in 'search' namespace
  external:
    enabled: true
    url: "http://opensearch-cluster-master.search.svc.cluster.local:9200"
    # Username and password will be set by CI/CD

# Service Bus (external)
servicebus:
  enabled: true
  # Connection string will be set by CI/CD

# Azure Storage Configuration (Production)
azure:
  storage:
    accountName: "productioncarpetastorage"
    accountKey: "" # Set via CI/CD from Terraform outputs
    containerName: "documents"
    useManagedIdentity: true
    # Account name will be set by CI/CD

# Azure AD B2C Configuration (Production)
azureB2C:
  enabled: true
  tenantName: "carpetaciudadana" # Set via CI/CD from Terraform outputs
  tenantId: "48d06645-ab3b-4ac4-b121-c63bb238ef6e" # Set via CI/CD from Terraform outputs
  clientId: "fad953e9-2497-4098-add3-fedaad529ac0" # Set via CI/CD from Terraform outputs
  clientSecret: "" # Set via CI/CD from Terraform outputs
  authorityUrl: "https://carpetaciudadana.b2clogin.com/carpetaciudadana.onmicrosoft.com/B2C_1_signupsignin1/v2.0"
  issuerUrl: "https://carpetaciudadana.b2clogin.com/carpetaciudadana.onmicrosoft.com/B2C_1_signupsignin1/v2.0"
  jwksUri: "https://carpetaciudadana.b2clogin.com/carpetaciudadana.onmicrosoft.com/B2C_1_signupsignin1/discovery/v2.0/keys"
  userFlowName: "B2C_1_signupsignin1"
  redirectUri: "https://app.carpeta-ciudadana.com/api/auth/callback/azure-ad-b2c"
  logoutRedirectUri: "https://app.carpeta-ciudadana.com"

# Database Migrations
migrations:
  enabled: true
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Pod Disruption Budgets
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Network Policies (Zero-Trust Networking)
networkPolicies:
  enabled: true
  denyAllByDefault: true
  allowDNS: true
  allowObservability: true

# Security Context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

